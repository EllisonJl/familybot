# FamilyBot é›†æˆæ¶æ„è¯´æ˜

## ğŸ—ï¸ æ–°æ¶æ„ä¼˜åŠ¿

æ‚¨çš„éœ€æ±‚å·²ç»å®Œç¾å®ç°ï¼ç°åœ¨FamilyBoté‡‡ç”¨é›†æˆæ¶æ„ï¼Œå‰ç«¯åªéœ€è¦ä¸åç«¯äº¤äº’ï¼ŒAI Agentä½œä¸ºå†…éƒ¨æœåŠ¡ã€‚

### æ¶æ„å¯¹æ¯”

**åŸæ¶æ„ (åˆ†ç¦»æ¨¡å¼)**:
```
å‰ç«¯ â†â†’ AI Agent    å‰ç«¯ â†â†’ åç«¯
:5173    :8001      :5173    :8080
```

**æ–°æ¶æ„ (é›†æˆæ¨¡å¼)**:
```
å‰ç«¯ â†â†’ åç«¯ â†â†’ AI Agent (å†…éƒ¨)
:5173    :8080    :8001 (å†…éƒ¨)
```

## ğŸ¯ é›†æˆæ¶æ„ç‰¹ç‚¹

### 1. ç»Ÿä¸€å…¥å£
- **å‰ç«¯åªè°ƒç”¨ä¸€ä¸ªåç«¯API**: `/api/v1/chat`
- **ç®€åŒ–å‰ç«¯å¼€å‘**: ä¸éœ€è¦ç®¡ç†å¤šä¸ªæœåŠ¡ç«¯ç‚¹
- **ç»Ÿä¸€é”™è¯¯å¤„ç†**: æ‰€æœ‰é”™è¯¯ç”±åç«¯ç»Ÿä¸€å¤„ç†å’Œæ ¼å¼åŒ–

### 2. å†…éƒ¨æœåŠ¡
- **AI Agentä¸å¯¹å¤–æš´éœ²**: åªç»‘å®š127.0.0.1ï¼Œæé«˜å®‰å…¨æ€§
- **åç«¯ä»£ç†æ‰€æœ‰AIè°ƒç”¨**: Spring Bootç»Ÿä¸€ç®¡ç†AIæœåŠ¡
- **æ— ç¼é›†æˆ**: ç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°å†…éƒ¨æœåŠ¡åˆ†ç¦»

### 3. å¢å¼ºåŠŸèƒ½
- **ç»Ÿä¸€æ—¥å¿—**: æ‰€æœ‰è¯·æ±‚é€šè¿‡åç«¯è®°å½•
- **æƒé™æ§åˆ¶**: åœ¨åç«¯å±‚é¢å®ç°ç”¨æˆ·æƒé™ç®¡ç†
- **æ•°æ®æŒä¹…åŒ–**: å¯¹è¯å†å²ã€ç”¨æˆ·åå¥½ç»Ÿä¸€å­˜å‚¨
- **ç›‘æ§å‘Šè­¦**: åç«¯å¯ä»¥ç›‘æ§AIæœåŠ¡å¥åº·çŠ¶æ€

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### å¯åŠ¨é›†æˆç³»ç»Ÿ
```bash
cd /Users/jllulu/Desktop/familybot
./start-integrated.sh
```

### æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
```bash
./status-integrated.sh
```

### åœæ­¢ç³»ç»Ÿ
```bash
./stop-integrated.sh
```

## ğŸŒ APIè°ƒç”¨æµç¨‹

### å‰ç«¯å‘é€æ¶ˆæ¯
```javascript
// å‰ç«¯åªéœ€è¦è°ƒç”¨ä¸€ä¸ªAPI
const response = await axios.post('/api/v1/chat', {
  userId: 'user123',
  characterId: 'xiyang',
  message: 'ä½ å¥½ï¼Œå„¿å­ï¼'
});
```

### åç«¯å¤„ç†æµç¨‹
1. **æ¥æ”¶å‰ç«¯è¯·æ±‚** â†’ Controllerå±‚
2. **ä¸šåŠ¡é€»è¾‘å¤„ç†** â†’ Serviceå±‚  
3. **è°ƒç”¨AI Agent** â†’ å†…éƒ¨HTTPè°ƒç”¨ (127.0.0.1:8001)
4. **æ•°æ®åº“å­˜å‚¨** â†’ ä¿å­˜å¯¹è¯å†å²
5. **è¿”å›ç»Ÿä¸€å“åº”** â†’ åŒ…å«AIå›å¤ã€æƒ…æ„Ÿã€è¯­éŸ³ç­‰

### AI Agentå“åº”æ ¼å¼
```json
{
  "characterId": "xiyang",
  "characterName": "å–œç¾Šç¾Š",
  "response": "çˆ¸çˆ¸å¥½ï¼æˆ‘æœ€è¿‘å·¥ä½œå¾ˆé¡ºåˆ©...",
  "emotion": "happy",
  "intent": "greeting",
  "ragEnhanced": true,
  "cotEnhanced": true,
  "cotStepsCount": 5,
  "audioBase64": "data:audio/wav;base64,..."
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### åç«¯é…ç½® (application-integrated.properties)
```properties
# AI Agentå†…éƒ¨æœåŠ¡åœ°å€
familybot.ai-agent.base-url=http://127.0.0.1:8001

# å‰ç«¯CORSé…ç½®
familybot.cors.allowed-origins=http://localhost:5173
```

### AI Agenté…ç½®
- **ç»‘å®šåœ°å€**: 127.0.0.1 (åªå…è®¸æœ¬æœºè®¿é—®)
- **ç«¯å£**: 8001
- **åŠŸèƒ½**: Chain of Thoughtæ¨ç†ã€Graph RAGã€å¤šè§’è‰²å¯¹è¯

## ğŸ’¡ å¼€å‘ä¼˜åŠ¿

### å‰ç«¯å¼€å‘è€…
```javascript
// ğŸ¯ ç®€åŒ– - åªéœ€è¦è®°ä½ä¸€ä¸ªAPIç«¯ç‚¹
const chatAPI = '/api/v1/chat';

// âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
if (response.status === 'ERROR') {
  showError(response.error);
}

// âœ… ä¸°å¯Œçš„å“åº”æ•°æ®
if (response.cotEnhanced) {
  showThinkingSteps(response.cotStepsCount);
}
```

### åç«¯å¼€å‘è€…
```java
// ğŸ¯ ç»Ÿä¸€çš„ä¸šåŠ¡é€»è¾‘å…¥å£
@PostMapping("/chat")
public ChatResponse chat(@RequestBody ChatRequest request) {
    // 1. å‚æ•°éªŒè¯
    // 2. è°ƒç”¨AIæœåŠ¡
    // 3. ä¿å­˜æ•°æ®åº“
    // 4. è¿”å›å“åº”
}

// âœ… å†…éƒ¨æœåŠ¡ç®¡ç†
@Service
public class AIAgentService {
    // WebClientè°ƒç”¨å†…éƒ¨AIæœåŠ¡
    // ç»Ÿä¸€å¼‚å¸¸å¤„ç†
    // æœåŠ¡å¥åº·æ£€æŸ¥
}
```

## ğŸ‰ æˆåŠŸå®ç°æ‚¨çš„éœ€æ±‚

âœ… **å‰ç«¯åªä¸åç«¯äº¤äº’** - å•ä¸€APIç«¯ç‚¹  
âœ… **AI Agentä½œä¸ºå†…éƒ¨æœåŠ¡** - ä¸å¯¹å¤–æš´éœ²  
âœ… **åç«¯ç»Ÿä¸€ç®¡ç†** - ä¸šåŠ¡é€»è¾‘ã€æ•°æ®å­˜å‚¨ã€æœåŠ¡è°ƒç”¨  
âœ… **å®Œæ•´åŠŸèƒ½ä¿ç•™** - CoTæ¨ç†ã€Graph RAGã€å¤šè§’è‰²å¯¹è¯  
âœ… **ç®€åŒ–éƒ¨ç½²è¿ç»´** - ä¸€é”®å¯åŠ¨ã€ç»Ÿä¸€ç›‘æ§  

## ğŸŒŸ ä¸‹ä¸€æ­¥æ‰©å±•

1. **è´Ÿè½½å‡è¡¡**: å¯ä»¥å¯åŠ¨å¤šä¸ªAI Agentå®ä¾‹
2. **æœåŠ¡å‘ç°**: é›†æˆEurekaæˆ–Consul
3. **APIç½‘å…³**: æ·»åŠ é™æµã€è®¤è¯ã€ç›‘æ§
4. **å®¹å™¨åŒ–**: DockeråŒ–éƒ¨ç½²
5. **å¾®æœåŠ¡**: è¿›ä¸€æ­¥æ‹†åˆ†ä¸šåŠ¡æ¨¡å—

---

**ğŸ  FamilyBotç°åœ¨ä»¥æ›´ä¼˜é›…çš„æ¶æ„ä¸ºç•™å®ˆè€äººæä¾›æ™ºèƒ½é™ªä¼´æœåŠ¡ï¼**
